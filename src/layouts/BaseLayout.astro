---
export interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  ogType?: string;
  publishDate?: string;
  layout?: string;
  xEyes?: boolean;
}

const {
  title,
  description = "Luke DeWitt - Developer from Halifax, Nova Scotia",
  ogImage = "/images/luke-head.png",
  ogType = "website",
  publishDate,
  layout = "page",
  xEyes = false,
} = Astro.props;

const siteURL = Astro.site || "https://www.whatadewitt.com";
const canonicalURL = new URL(Astro.url.pathname, siteURL);

let ogImageURL = "";
try {
  if (ogImage && ogImage.startsWith("http")) {
    ogImageURL = ogImage;
  } else if (ogImage) {
    ogImageURL = new URL(ogImage, siteURL).toString();
  } else {
    ogImageURL = new URL("/images/luke-head.png", siteURL).toString();
  }
} catch (e) {
  ogImageURL = siteURL + "/images/luke-head.png";
}

// Google Tag Manager
const gtmId = Astro.env?.GTM_ID || "";

import HomepageLayout from "../components/layouts/HomepageLayout.astro";
import BlogLayoutContent from "../components/layouts/BlogLayoutContent.astro";
import PageLayout from "../components/layouts/PageLayout.astro";
import "../styles/global.css";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL.toString()} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalURL.toString()} />
    <meta property="og:image" content={ogImageURL} />
    {
      publishDate && (
        <meta property="article:published_time" content={publishDate} />
      )
    }
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <link rel="icon" href="/favicon-32x32.png" type="image/png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <script is:inline>
      if (
        localStorage.getItem("color-theme") === "dark" ||
        (!("color-theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      }
    </script>

    <!-- Google Tag Manager -->
    {gtmId && (
      <script is:inline>
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
          'gtm.start': new Date().getTime(),
          event: 'gtm.js'
        });
      </script>
      <script type="text/partytown" src={"https://www.googletagmanager.com/gtm.js?id=" + gtmId}></script>
    )}
  </head>
  <body class="min-h-screen">
    <!-- Google Tag Manager (noscript) -->
    {gtmId && (
      <noscript>
        <iframe src={"https://www.googletagmanager.com/ns.html?id=" + gtmId}
          height="0" width="0" style="display:none;visibility:hidden"></iframe>
      </noscript>
    )}

    {
      layout === "homepage" && (
        <HomepageLayout xEyes={xEyes}>
          <>
            <slot name="controls" slot="controls" />
            <slot />
          </>
        </HomepageLayout>
      )
    }
    {
      layout === "blog" && (
        <BlogLayoutContent>
          <>
            <slot name="controls" slot="controls" />
            <slot />
          </>
        </BlogLayoutContent>
      )
    }
    {
      layout === "page" && (
        <PageLayout>
          <>
            <slot name="controls" slot="controls" />
            <slot />
          </>
        </PageLayout>
      )
    }
  </body>

  <style is:global>
    :root {
      --bg-color: #f5f3ff;
      --text-color: #1c1917;
      --primary-color: #7c3aed;
      --secondary-color: #5b21b6;
      --container-bg: rgba(255, 255, 255, 0.5);
      --svg-bg: rgba(124, 58, 237, 0.05);
      --link-bg: rgba(0, 0, 0, 0.05);
      --link-hover-bg: rgba(124, 58, 237, 0.1);
      --shadow-color: rgba(124, 58, 237, 0.1);
      --svg-stroke-1: #6d28d9;
      --svg-stroke-2: #7c3aed;
      --svg-stroke-3: #8b5cf6;
      --toast-bg: rgba(28, 25, 23, 0.8);
      --toast-text: #f8f5f2;
      --font-mono-jetbrains: "JetBrains Mono", monospace;
    }

    html.dark {
      --bg-color: #111111;
      --text-color: #e0e7ff;
      --primary-color: #8b5cf6;
      --secondary-color: #a78bfa;
      --container-bg: rgba(25, 25, 25, 0.5);
      --svg-bg: rgba(139, 92, 246, 0.05);
      --link-bg: rgba(255, 255, 255, 0.05);
      --link-hover-bg: rgba(139, 92, 246, 0.15);
      --shadow-color: rgba(139, 92, 246, 0.1);
      --svg-stroke-1: #a78bfa;
      --svg-stroke-2: #8b5cf6;
      --svg-stroke-3: #7c3aed;
      --toast-bg: rgba(224, 231, 255, 0.8);
      --toast-text: #010101;
    }

    body {
      font-family: var(--font-mono-jetbrains);
      background-color: var(--bg-color);
      color: var(--text-color);
      transition:
        background-color 0.3s ease,
        color 0.3s ease;
    }
  </style>
</html>
